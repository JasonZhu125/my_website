
```{r, setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, include=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(lubridate)
library(here)
library(skimr)
library(janitor)
library(httr)
library(readxl)
library(vroom)
```


# Biden's Approval Margins

```{r, cache=TRUE}
approval_polllist <- read_csv('https://projects.fivethirtyeight.com/biden-approval-data/approval_polllist.csv') 

glimpse(approval_polllist)

approval_polllist <- approval_polllist %>% 
mutate(
enddate=mdy(enddate),
week=week(enddate),
)

```

## Plot

The average net approval rate (approve- disapprove) for each week since he got into office with the net approval and its 95% confidence interval. 

```{r trump_margins, echo=FALSE, out.width="100%"}
knitr::include_graphics(here::here("images", "biden_approval_margin.png"), error = FALSE)
approval_polllist %>% 
  filter(subgroup == 'All polls') %>% 
  group_by(week) %>% 
  summarise(
    av_net_approval_rate=mean(approve-disapprove),
    sd_net_approval_rate = sd(approve-disapprove),
    count = n(),
    se_net_approval_rate = sd_net_approval_rate/ sqrt(count),
    # Get interval upper and lower values
    t_critical = qt(0.975, count - 1 ),
    lower = av_net_approval_rate - t_critical * se_net_approval_rate,
    upper = av_net_approval_rate + t_critical * se_net_approval_rate
  ) %>% 
  
  ggplot(aes(x=week, y=av_net_approval_rate))+
geom_line(color="red",size=0.3)+
geom_point(color="red",size=0.3)+
geom_smooth(size=0.8,method = 'loess',  se=FALSE)+
geom_line(aes(x=week, y=0),color="orange",size=1.5)+
geom_ribbon(aes(ymin=lower,ymax=upper),alpha=0.1,color="red",size=0.2)+
scale_x_continuous(breaks=c(3,25))+
labs(title="Estimating Approval Margin (approve-disapprove) for Joe Biden", subtitle= "Weekly average of all polls",x="Week of the year", y= "Average Approval Margin (approve - disapprove)") 
```

The confidence interval at week 3 is a lot wider than the one at week 25. This is merely due to statistical reason which is related to the number of polls executed at those times. At week 3, only 5 polls were executed whereas at week 25, 29 pools were done. Mechanically, the standard errors is lower for week 25 than week 3 which narrows the confidence interval.


