
```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(lubridate)
library(fivethirtyeight)
library(here)
library(skimr)
library(janitor)
library(vroom)
library(tidyquant)
library(rvest) # to scrape wikipedia page
```

# Analysis of movies- IMDB dataset

Firstly take a look at a subset sample of movies, taken from the [Kaggle IMDB 5000 movie dataset](https://www.kaggle.com/carolzhangdc/imdb-5000-movie-dataset)
  
```{r,load_movies, warning=FALSE, message=FALSE}

movies <- read_csv(here::here("data", "movies.csv"))
glimpse(movies)

```

Besides the obvious variables of `title`, `genre`, `director`, `year`, and `duration`, the rest of the variables are as follows:

- `gross` : The gross earnings in the US box office, not adjusted for inflation
- `budget`: The movie's budget 
- `cast_facebook_likes`: the number of facebook likes cast memebrs received
- `votes`: the number of people who voted for (or rated) the movie in IMDB 
- `reviews`: the number of reviews for that movie
- `rating`: IMDB average rating 

A table with the count of movies by genre, ranked in descending order

```{r,load_movies, warning=FALSE, message=FALSE}
movies %>% 
  group_by(genre) %>% 
  count(sort=TRUE)
```

A table with the average gross earning and budget (`gross` and `budget`) by genre. Please find the calculation of a variable `return_on_budget` which shows how many $ did a movie make at the box office for each $ of its budget, with genres by this `return_on_budget` ranked in descending order

```{r,load_movies, warning=FALSE, message=FALSE}
movies %>% 
  group_by(genre) %>% 
  summarise(average_gross=mean(gross),average_budget=mean(budget),return_on_budget=average_gross/average_budget) %>% 
  arrange(desc(return_on_budget))
```

A table showing the top 15 directors who have created the highest gross revenue in the box office. Don't just show the total gross amount, but also the mean, median, and standard deviation per director.

```{r,load_movies, warning=FALSE, message=FALSE}
movies %>% 
  group_by(director) %>% 
  summarise(total_gross=sum(gross), average_gross=mean(gross), median_gross=median(gross),std_gross=sd(gross)) %>% 
  slice_max(order_by = total_gross, n=15)

```
A table describing how ratings are distributed by genre.

```{r,load_movies, warning=FALSE, message=FALSE}

movies %>%
  group_by(genre) %>% 
  summarise(mean_rating=mean(rating),median_rating=median(rating),sd_rating=sd(rating))

```
```{r,load_movies, warning=FALSE, message=FALSE}

movies %>% 
  ggplot(aes(x=rating)) +
  geom_histogram(binwidth = 0.5)+
  facet_wrap(~genre)

```


Scatterplot showing the relationship between `gross` and `cast_facebook_likes`.
  
  
```{r, gross_on_fblikes}
movies %>% 
  ggplot(aes(x=gross,y=cast_facebook_likes)) +
  geom_point()+
  scale_x_log10()+
  scale_y_log10()+
  geom_smooth(method="lm")
cor(movies$gross,movies$cast_facebook_likes)
```

Key takeaways:
There is a positive correlation between the gross and facebook lines but as it can be seen from both the scatter plot and the correlation figure it is not strong. Therefore, ideally we shouldn’t use this as a single metric to predict.

Scatterplot examining the relationship between `gross` and `budget`. 

```{r, gross_on_budget}
movies %>% 
  ggplot(aes(x=gross,y=budget)) +
  geom_point()+
  geom_smooth(method="lm")
cor(movies$gross,movies$budget)
```

Key takeaways:
There is a strong correlation of 0.64 between budget and gross. The relationship is also apperant in the scatter plot. That means more budget a movie has more gross it will achive.

Scatterplot examining the relationship between `gross` and `rating`.

```{r, gross_on_rating}
movies %>% 
  ggplot(aes(x=gross,y=rating)) +
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~genre,scale="free")
```

Key takeaways:
IMDB ratings are not a good predictor of the gross for most of the genres. There are strange findings as in some genres such as sci-fi and documentary, the ratings and the gross are negatively correlated. Also for some genres such as thriller, musical and romance, there aren’t enough data samples to determine a regression.

